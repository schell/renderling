on: [push]

name: push

jobs:
  renderling-build-shaders:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: |
          # ensure the shader binaries were properly checked in
          rm -rf crates/renderling/src/linkage/*.spv
          cd shaders && cargo run --release && cd ..
          git diff --exit-code --no-ext-diff crates/renderling/src/linkage

  renderling-test:
    strategy:
      fail-fast: false
      matrix:
        label: [pi4, intel, amd]
    continue-on-error: true
    runs-on: ${{ matrix.label }}
    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: cargo test
        env:
          RUST_BACKTRACE: 1

  renderling-clippy:
    strategy:
      fail-fast: false
      matrix:
        label: [pi4, intel, amd]
    continue-on-error: true
    runs-on: ${{ matrix.label }}
    steps:
      - uses: actions/checkout@v2
      - uses: actions-rs/toolchain@v1
        with:
          toolchain: stable
      - run: cargo clippy
